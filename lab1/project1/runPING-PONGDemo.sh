#!/bin/bash

clear
#####################################################################
# Compile all *.java files:
#####################################################################
find . -name "*.java" -print | xargs javac

#####################################################################
# Build images:
#####################################################################

docker build -t clientImg .
docker build -t serverImg .

#####################################################################
# Start running containers
#####################################################################

docker run clientImg java ./pingPong/server/Server 7000
docker run serverImg java ./pingPong/client/Client 7000

#####################################################################
# Display the result
#####################################################################


printf "================================================================================\n\nClient logs:\n\n"
docker logs clientImg
printf "\n================================================================================\n\nServer logs:\n\n"
docker logs serverImg
printf "\n================================================================================\n"

#####################################################################
# Clean up
#####################################################################
printf "\n>>Start to clear up...\n\n"
find . -name '*.class' -delete

docker rm $(docker ps -a -q)
docker rmi clientImg
docker rmi serverImg
